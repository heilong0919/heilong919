<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é¥­åº—å‰å°ç®¡ç†ç³»ç»Ÿ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #f8fafc; color: #1e293b; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; padding: 25px; border-radius: 16px; margin-bottom: 30px; text-align: center; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); }
        .tabs { display: flex; background: white; border-radius: 12px 12px 0 0; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 0; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-weight: 700; color: #64748b; background: #f1f5f9; border-bottom: 4px solid transparent; transition: all 0.3s; }
        .tab.active { background: white; color: #3b82f6; border-bottom-color: #3b82f6; }
        .tab-content { display: none; background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .tab-content.active { display: block; }
        .card { background: #f8fafc; padding: 25px; border-radius: 12px; margin-bottom: 25px; border-left: 5px solid #3b82f6; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.2s; margin: 5px; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #94a3b8; color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin: 25px 0; }
        .menu-item { background: white; padding: 20px; border-radius: 10px; border: 2px solid #e2e8f0; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; }
        .menu-item:hover, .menu-item.selected { border-color: #3b82f6; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15); }
        .menu-item-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; }
        .menu-item-name { font-weight: 800; margin-bottom: 10px; font-size: 1.1em; }
        .menu-item-price { color: #10b981; font-size: 1.4em; font-weight: 900; }
        .menu-item-category { font-size: 0.85em; color: #64748b; background: #e2e8f0; padding: 3px 10px; border-radius: 20px; margin-top: 10px; display: inline-block; }
        .form-row { display: flex; gap: 15px; margin-bottom: 20px; }
        .form-input { flex: 1; padding: 14px; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 1em; }
        .form-input:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .orders-list { max-height: 400px; overflow-y: auto; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .order-item { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #e2e8f0; align-items: center; }
        .sound-item { display: flex; justify-content: space-between; align-items: center; padding: 18px; background: white; border-radius: 10px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .notification { position: fixed; top: 30px; right: 30px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); border-left: 6px solid #10b981; display: flex; align-items: center; gap: 15px; transform: translateX(400px); transition: transform 0.5s ease; z-index: 9999; }
        .notification.show { transform: translateX(0); }
        .notification.error { border-left-color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-store"></i> é¥­åº—å‰å°ç®¡ç†ç³»ç»Ÿ</h1>
            <p>ç‚¹é¤ä¸‹å• | èœå•ç®¡ç† | é“ƒå£°ç®¡ç† | æ•°æ®å®æ—¶åŒæ­¥</p>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('order')">ğŸ½ï¸ ç‚¹é¤ä¸‹å•</div>
            <div class="tab" onclick="switchTab('menu')">ğŸ“ èœå•ç®¡ç†</div>
            <div class="tab" onclick="switchTab('sound')">ğŸ”” é“ƒå£°ç®¡ç†</div>
        </div>

        <!-- ç‚¹é¤æ ‡ç­¾é¡µ -->
        <div id="tab-order" class="tab-content active">
            <div class="card">
                <h2><i class="fas fa-hamburger"></i> è¯·é€‰æ‹©èœå“</h2>
                <div class="menu-grid" id="orderMenuGrid">åŠ è½½ä¸­...</div>
                <div class="form-row">
                    <div style="display: flex; align-items: center; background: #e2e8f0; border-radius: 8px; padding: 5px;">
                        <button class="qty-btn" onclick="changeQty(-1)" style="width: 50px; height: 50px; border: none; background: #cbd5e1; font-size: 1.5em; cursor: pointer; border-radius: 6px 0 0 6px;">-</button>
                        <input type="text" id="orderQty" value="1" readonly style="width: 70px; text-align: center; border: none; background: transparent; font-size: 1.4em; font-weight: 800;">
                        <button class="qty-btn" onclick="changeQty(1)" style="width: 50px; height: 50px; border: none; background: #cbd5e1; font-size: 1.5em; cursor: pointer; border-radius: 0 6px 6px 0;">+</button>
                    </div>
                    <button class="btn btn-primary" onclick="addToOrder()"><i class="fas fa-cart-plus"></i> åŠ å…¥è®¢å•</button>
                    <button class="btn btn-success" onclick="submitOrder()"><i class="fas fa-paper-plane"></i> å‘é€åˆ°å¨æˆ¿</button>
                </div>
            </div>
            <div class="card">
                <h2><i class="fas fa-receipt"></i> å½“å‰è®¢å•</h2>
                <div class="orders-list" id="currentOrderList">è®¢å•ä¸ºç©º</div>
                <div style="text-align: right;">
                    <button class="btn btn-danger" onclick="clearOrder()"><i class="fas fa-trash-alt"></i> æ¸…ç©ºè®¢å•</button>
                </div>
            </div>
        </div>

        <!-- èœå•ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="tab-menu" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°èœå“</h2>
                <div class="form-row">
                    <input type="text" id="newDishName" class="form-input" placeholder="èœå“åç§° (å¦‚ï¼šé±¼é¦™è‚‰ä¸)">
                    <input type="number" step="0.01" id="newDishPrice" class="form-input" placeholder="ä»·æ ¼ (å¦‚ï¼š38.00)">
                    <input type="text" id="newDishCategory" class="form-input" placeholder="åˆ†ç±» (å¦‚ï¼šçƒ­èœã€æ±¤ç±»)">
                </div>
                <button class="btn btn-primary" onclick="addMenuItem()"><i class="fas fa-save"></i> ä¿å­˜èœå“</button>
            </div>
            <div class="card">
                <h2><i class="fas fa-list"></i> æ‰€æœ‰èœå“ <small>(å…± <span id="dishCount">0</span> ä¸ª)</small></h2>
                <div class="menu-grid" id="allMenuGrid">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- é“ƒå£°ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="tab-sound" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°æç¤ºéŸ³</h2>
                <div class="form-row">
                    <input type="text" id="newSoundName" class="form-input" placeholder="é“ƒå£°åç§° (å¦‚ï¼šæ¸…è„†æç¤º)">
                    <input type="text" id="newSoundUrl" class="form-input" placeholder="MP3/WAVéŸ³é¢‘ç›´é“¾ (URL)">
                </div>
                <button class="btn btn-primary" onclick="addSound()"><i class="fas fa-save"></i> ä¿å­˜é“ƒå£°</button>
                <button class="btn btn-secondary" onclick="playTestSound()"><i class="fas fa-volume-up"></i> æµ‹è¯•å½“å‰é“ƒå£°</button>
            </div>
            <div class="card">
                <h2><i class="fas fa-music"></i> é“ƒå£°åº“ <small>(å…± <span id="soundCount">0</span> ä¸ª)</small></h2>
                <div id="allSoundList">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- å…¨å±€é€šçŸ¥ -->
    <div class="notification" id="notification">
        <i class="fas fa-bell" id="notificationIcon"></i>
        <div>
            <div id="notificationTitle">é€šçŸ¥</div>
            <div id="notificationMessage">æ¶ˆæ¯å†…å®¹</div>
        </div>
    </div>

    <!-- å¼•å…¥Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // ==================== é…ç½®åŒº (å¿…é¡»ä¿®æ”¹!) ====================
        const SUPABASE_URL = 'https://xpipcumwxnvkllcqvsql.supabase.co'; // æ›¿æ¢ä¸ºä½ çš„URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhwaXBjdW13eG52a2xsY3F2c3FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MjU5NDIsImV4cCI6MjA4MzUwMTk0Mn0.X_qVVwYCxFhM1ScgAal2l-rKaOOQIwRx04t8agvv5cg'; // æ›¿æ¢ä¸ºä½ çš„å¯†é’¥
        // =========================================================

        // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // å…¨å±€çŠ¶æ€
        let currentOrder = [];
        let selectedDishId = null;
        let menuItems = [];
        let soundOptions = [];

        // åˆå§‹åŒ–ï¼šåŠ è½½æ•°æ®
        async function init() {
            await Promise.all([loadMenuItems(), loadSoundOptions()]);
            switchTab('order'); // é»˜è®¤æ˜¾ç¤ºç‚¹é¤
            showNotification('ç³»ç»Ÿå°±ç»ª', 'æ‰€æœ‰åŠŸèƒ½å·²åŠ è½½å®Œæˆã€‚', 'success');
            console.log('åˆå§‹åŒ–å®Œæˆã€‚èœå•:', menuItems.length, 'ä¸ªï¼›é“ƒå£°:', soundOptions.length, 'ä¸ª');
        }

        // åŠ è½½èœå•
        async function loadMenuItems() {
            const { data, error } = await supabase.from('menu_items').select('*').order('id');
            if (error) {
                console.error('åŠ è½½èœå•å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'åŠ è½½èœå•å¤±è´¥: ' + error.message, 'error');
                return;
            }
            menuItems = data || [];
            renderOrderMenu();
            renderAllMenu();
        }

        // åŠ è½½æç¤ºéŸ³
        async function loadSoundOptions() {
            const { data, error } = await supabase.from('sound_options').select('*').order('id');
            if (error) {
                console.error('åŠ è½½æç¤ºéŸ³å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'åŠ è½½æç¤ºéŸ³å¤±è´¥: ' + error.message, 'error');
                return;
            }
            soundOptions = data || [];
            renderAllSounds();
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            const activeTab = document.querySelector(`.tab[onclick*="${tabName}"]`);
            if (activeTab) activeTab.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // ==================== ç‚¹é¤åŠŸèƒ½ ====================
        function renderOrderMenu() {
            const grid = document.getElementById('orderMenuGrid');
            if (!menuItems.length) {
                grid.innerHTML = '<p style="text-align:center; padding: 40px; color: #94a3b8;">æš‚æ— èœå“ï¼Œè¯·å…ˆåœ¨â€œèœå•ç®¡ç†â€ä¸­æ·»åŠ ã€‚</p>';
                return;
            }
            grid.innerHTML = menuItems.map(item => `
                <div class="menu-item ${selectedDishId === item.id ? 'selected' : ''}" onclick="selectDish(${item.id})">
                    <div class="menu-item-name">${item.name}</div>
                    <div class="menu-item-price">Â¥${item.price.toFixed(2)}</div>
                    <div class="menu-item-category">${item.category}</div>
                </div>
            `).join('');
        }

        function selectDish(id) {
            selectedDishId = id;
            renderOrderMenu();
        }

        function changeQty(delta) {
            let qty = parseInt(document.getElementById('orderQty').value) + delta;
            if (qty < 1) qty = 1;
            document.getElementById('orderQty').value = qty;
        }

        function addToOrder() {
            if (!selectedDishId) { showNotification('æç¤º', 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªèœå“', 'info'); return; }
            const dish = menuItems.find(d => d.id === selectedDishId);
            const qty = parseInt(document.getElementById('orderQty').value);
            const existing = currentOrder.find(item => item.id === dish.id);
            if (existing) existing.quantity += qty;
            else currentOrder.push({ id: dish.id, name: dish.name, price: dish.price, quantity: qty });
            renderCurrentOrder();
            selectedDishId = null;
            document.getElementById('orderQty').value = 1;
            renderOrderMenu();
            showNotification('å·²æ·»åŠ ', `${dish.name} Ã— ${qty}`, 'success');
        }

        function renderCurrentOrder() {
            const container = document.getElementById('currentOrderList');
            if (!currentOrder.length) { container.innerHTML = '<p style="text-align:center; padding: 30px; color: #94a3b8;">è®¢å•ä¸ºç©ºï¼Œè¯·æ·»åŠ èœå“ã€‚</p>'; return; }
            let total = 0;
            container.innerHTML = currentOrder.map(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;
                return `<div class="order-item"><div><strong>${item.name}</strong><br><small>å•ä»·: Â¥${item.price.toFixed(2)}</small></div><div><strong>Ã—${item.quantity}</strong><br><strong style="color:#10b981;">Â¥${subtotal.toFixed(2)}</strong></div></div>`;
            }).join('') + `<div class="order-item" style="background:#f1f5f9; border-top:2px solid #cbd5e1; font-weight:900;"><div>è®¢å•æ€»è®¡</div><div style="color:#3b82f6; font-size:1.2em;">Â¥${total.toFixed(2)}</div></div>`;
        }

        function clearOrder() {
            if (!currentOrder.length || !confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰è®¢å•å—ï¼Ÿ')) return;
            currentOrder = [];
            renderCurrentOrder();
            showNotification('å·²æ¸…ç©º', 'å½“å‰è®¢å•å·²æ¸…ç©º', 'info');
        }

        async function submitOrder() {
            if (!currentOrder.length) { showNotification('æç¤º', 'è®¢å•ä¸ºç©ºï¼Œæ— æ³•æäº¤', 'info'); return; }
            const orderToSend = { items: currentOrder, status: 'new' };
            const { error } = await supabase.from('orders').insert([orderToSend]);
            if (error) {
                console.error('æäº¤è®¢å•å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'æäº¤å¤±è´¥: ' + error.message, 'error');
            } else {
                showNotification('æˆåŠŸ', 'è®¢å•å·²å‘é€åˆ°åå¨ï¼', 'success');
                currentOrder = [];
                renderCurrentOrder();
            }
        }

        // ==================== èœå•ç®¡ç†åŠŸèƒ½ ====================
        function renderAllMenu() {
            const grid = document.getElementById('allMenuGrid');
            const countEl = document.getElementById('dishCount');
            countEl.textContent = menuItems.length;
            if (!menuItems.length) {
                grid.innerHTML = '<p style="text-align:center; padding: 40px; color: #94a3b8;">æš‚æ— èœå“ï¼Œè¯·æ·»åŠ ã€‚</p>';
                return;
            }
            grid.innerHTML = menuItems.map(item => `
                <div class="menu-item">
                    <div class="menu-item-actions">
                        <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 0.8em;" onclick="editMenuItem(${item.id})" title="ç¼–è¾‘"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger" style="padding: 6px 10px; font-size: 0.8em;" onclick="deleteMenuItem(${item.id})" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="menu-item-name">${item.name}</div>
                    <div class="menu-item-price">Â¥${item.price.toFixed(2)}</div>
                    <div class="menu-item-category">${item.category}</div>
                </div>
            `).join('');
        }

        async function addMenuItem() {
            const name = document.getElementById('newDishName').value.trim();
            const price = parseFloat(document.getElementById('newDishPrice').value);
            const category = document.getElementById('newDishCategory').value.trim();
            if (!name || isNaN(price) || price <= 0 || !category) {
                showNotification('è¾“å…¥é”™è¯¯', 'è¯·å¡«å†™å®Œæ•´çš„èœå“ä¿¡æ¯ï¼ˆåç§°ã€æœ‰æ•ˆä»·æ ¼ã€åˆ†ç±»ï¼‰', 'error');
                return;
            }
            const { data, error } = await supabase.from('menu_items').insert([{ name, price, category }]).select();
            if (error) {
                console.error('æ·»åŠ èœå“å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'æ·»åŠ å¤±è´¥: ' + error.message, 'error');
            } else {
                menuItems.push(data[0]);
                renderOrderMenu();
                renderAllMenu();
                document.getElementById('newDishName').value = '';
                document.getElementById('newDishPrice').value = '';
                document.getElementById('newDishCategory').value = '';
                showNotification('æˆåŠŸ', `"${name}" å·²æ·»åŠ åˆ°èœå•`, 'success');
            }
        }

        async function deleteMenuItem(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèœå“å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) return;
            const { error } = await supabase.from('menu_items').delete().eq('id', id);
            if (error) {
                console.error('åˆ é™¤èœå“å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            } else {
                menuItems = menuItems.filter(item => item.id !== id);
                currentOrder = currentOrder.filter(item => item.id !== id); // ä¹Ÿä»å½“å‰è®¢å•ç§»é™¤
                renderOrderMenu();
                renderAllMenu();
                renderCurrentOrder();
                showNotification('å·²åˆ é™¤', 'èœå“å·²åˆ é™¤', 'info');
            }
        }

        function editMenuItem(id) {
            const item = menuItems.find(d => d.id === id);
            if (!item) return;
            const newName = prompt('ä¿®æ”¹èœå“åç§°:', item.name);
            if (newName === null) return;
            const newPrice = parseFloat(prompt('ä¿®æ”¹ä»·æ ¼:', item.price));
            if (isNaN(newPrice) || newPrice <= 0) {
                showNotification('é”™è¯¯', 'ä»·æ ¼æ— æ•ˆï¼Œä¿®æ”¹å–æ¶ˆ', 'error');
                return;
            }
            const newCategory = prompt('ä¿®æ”¹åˆ†ç±»:', item.category);
            if (newCategory === null) return;
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨supabase.updateï¼Œä¸ºç®€åŒ–ï¼Œæˆ‘ä»¬é‡‡ç”¨å…ˆåˆ åå¢
            deleteMenuItem(id);
            // è¿™é‡Œå¯ä»¥ä¼˜åŒ–ä¸ºç›´æ¥æ›´æ–°ï¼Œä½†ä¸ºäº†é€»è¾‘æ¸…æ™°ï¼Œæš‚ç”¨æ­¤æ–¹å¼
            setTimeout(() => {
                document.getElementById('newDishName').value = newName;
                document.getElementById('newDishPrice').value = newPrice;
                document.getElementById('newDishCategory').value = newCategory;
                showNotification('æç¤º', 'è¯·åœ¨è¡¨å•ä¸­ç¡®è®¤ä¿®æ”¹å¹¶ç‚¹å‡»â€œä¿å­˜èœå“â€', 'info');
                switchTab('menu');
            }, 300);
        }

        // ==================== é“ƒå£°ç®¡ç†åŠŸèƒ½ ====================
        function renderAllSounds() {
            const container = document.getElementById('allSoundList');
            const countEl = document.getElementById('soundCount');
            countEl.textContent = soundOptions.length;
            if (!soundOptions.length) {
                container.innerHTML = '<p style="text-align:center; padding: 40px; color: #94a3b8;">æš‚æ— æç¤ºéŸ³ï¼Œè¯·æ·»åŠ ã€‚</p>';
                return;
            }
            container.innerHTML = soundOptions.map(sound => `
                <div class="sound-item">
                    <div style="flex: 1;">
                        <strong>${sound.name}</strong><br>
                        <small style="color: #64748b; word-break: break-all; font-size: 0.85em;">${sound.url}</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" style="padding: 8px 12px;" onclick="playSound('${sound.url}')"><i class="fas fa-play"></i> è¯•å¬</button>
                        <button class="btn btn-danger" style="padding: 8px 12px;" onclick="deleteSound(${sound.id})"><i class="fas fa-trash"></i> åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        async function addSound() {
            const name = document.getElementById('newSoundName').value.trim();
            const url = document.getElementById('newSoundUrl').value.trim();
            if (!name || !url) {
                showNotification('è¾“å…¥é”™è¯¯', 'è¯·å¡«å†™é“ƒå£°åç§°å’Œæœ‰æ•ˆçš„URL', 'error');
                return;
            }
            if (!url.startsWith('http')) {
                showNotification('URLé”™è¯¯', 'è¯·è¾“å…¥æœ‰æ•ˆçš„httpæˆ–httpsé“¾æ¥', 'error');
                return;
            }
            const { data, error } = await supabase.from('sound_options').insert([{ name, url }]).select();
            if (error) {
                console.error('æ·»åŠ é“ƒå£°å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'æ·»åŠ å¤±è´¥: ' + error.message, 'error');
            } else {
                soundOptions.push(data[0]);
                renderAllSounds();
                document.getElementById('newSoundName').value = '';
                document.getElementById('newSoundUrl').value = '';
                showNotification('æˆåŠŸ', `"${name}" å·²æ·»åŠ åˆ°é“ƒå£°åº“`, 'success');
            }
        }

        async function deleteSound(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé“ƒå£°å—ï¼Ÿ')) return;
            const { error } = await supabase.from('sound_options').delete().eq('id', id);
            if (error) {
                console.error('åˆ é™¤é“ƒå£°å¤±è´¥:', error);
                showNotification('é”™è¯¯', 'åˆ é™¤å¤±è´¥: ' + error.message, 'error');
            } else {
                soundOptions = soundOptions.filter(s => s.id !== id);
                renderAllSounds();
                showNotification('å·²åˆ é™¤', 'é“ƒå£°å·²åˆ é™¤', 'info');
            }
        }

        function playSound(url) {
            const audio = new Audio(url);
            audio.play().catch(e => {
                console.error('æ’­æ”¾å¤±è´¥:', e);
                showNotification('æ’­æ”¾å¤±è´¥', 'æ— æ³•æ’­æ”¾æ­¤éŸ³é¢‘ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æœ‰æ•ˆ', 'error');
            });
        }

        function playTestSound() {
            const url = document.getElementById('newSoundUrl').value.trim();
            if (!url) {
                showNotification('æç¤º', 'è¯·è¾“å…¥è¦æµ‹è¯•çš„éŸ³é¢‘URL', 'info');
                return;
            }
            playSound(url);
        }

        // ==================== é€šç”¨å·¥å…·å‡½æ•° ====================
        function showNotification(title, message, type = 'success') {
            const note = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            note.className = 'notification' + (type === 'error' ? ' error' : '');
            icon.className = type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
            note.classList.add('show');
            setTimeout(() => note.classList.remove('show'), 3500);
        }

        // å¯åŠ¨
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
